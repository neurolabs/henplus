<html>
<head><title>HenPlus documentation</title></head>
<body bgcolor="white">
<!-- $Id: HenPlus.html,v 1.7 2002-07-23 06:34:55 hzeller Exp $ -->
<h1 align="center">HenPlus</h1>
<h3 align="center">JDBC SQL-shell</h3>

<table align="right" bgcolor="#DDDDFF">
<tr><th>Table of Contents</th></tr>
<tr><td><a href="#overview">Overview</a></td></tr>
<tr><td><a href="#getting-started">Getting Started</a></td></tr>
<tr><td><a href="#getting-connected">Getting Connected</a></td></tr>
<tr><td><a href="#multiple-open-sessions">Multiple Open Sessions</a></td></tr>
<tr><td><a href="#variables">Using Variables</a></td></tr>
<tr><td><a href="#commandline-completion">Commandline Completion</a></td></tr>
<tr><td><a href="#per-project-config">Per Project Configuration</a></td></tr>
<tr><td><a href="#plugins">Plugins</a></td></tr>
<tr><td><a href="#aliases">Aliases</a></td></tr>
<tr><td><a href="#table-dumps">Table Dumps</a></td></tr>
<tr><td><hr></td></tr>
<tr><td><a href="#faq">FAQ</a></td></tr>
<tr><td><a href="http://sourceforge.net/projects/henplus">Download</a></td></tr>
</table>

<h3>History</h3>
Know this ? You need a small little tool for your everyday work and
you wonder why nobody did this before -- and then you write it yourself.
HenPlus is the result of such an effort. Its name reflects the original 
intent: it started as a platform independent replacement for the 
Oracle SQLPlus tool. 
I wrote the first version of HenPlus in 1997 (before
Oracle was available for Linux) since I had to develop an application that 
connected to an Oracle database -- but the only SQLPlus I could use
in the environment back then was running on some Redmond operation
system that lacked (and still lacks) the environment to develop serious software.
<br>Since then, I've rewritten
this tool, added command line completion and history -- but it still
remained small and useful. It is freely distributable in source 
and binary form because it is protected by the 
<a href="http://www.gnu.org/licenses/gpl.txt">GNU Public License</a>.

<h3><a name="overview"/>Overview</h3>
HenPlus is a SQL shell written in Java that works for any database 
that has JDBC support. So
basically any database. Why do we need this ? Any database comes with some
shell, but all of them have missing features (and several shells are simply 
unusable).
And if you work with several
databases at once (if you are a developer, then you do this all the time),
then switching between these tools is tedious.
<p>
This is where <em>HenPlus</em> steps in. It supports:
<ul>
 <li>Any JDBC aware database.</li>
 <li>Has context sensitive command line completion for commands 
     and tables / columns / variables within SQL-commands. </li>
 <li>Multiple open connection-sessions can be handled in parallel. You can just
     switch between them. So you can be connected to different databases to
     experiment with the same statement in all of them, for example.<br>
     All JDBC-Urls of opened sessions are stored for
     later command line completion in the <code>connect</code> command.</li>
 <li>Command line history just like in the bash (with cursor-up/down, CTRL-R, 
     ...)
     </li>
 <li>A <code>describe</code> command for database tables, that work all
     JDBC-Drivers that unveil the appropriate MetaData (Oracle, PostgreSQL,
     MySQL, DB2...)</li>
 <li>supports variables that are expanded like shell variables
     with $VARIABLENAME or ${VARIABLENAME} (with completion of their names,
     just like in bash)</li>
 <li>loading files</li>
 <li>supports several built-in commands (<code>start</code>, <code>@</code>,
     <code>@@</code>, <code>spool</code>) and
     syntax from the Oracle SQL-plus utility (like the single '/' on a line
     to close a statement). Most Oracle SQL-plus scripts will run directly, so
     its simple to switch to HenPlus. Except if you can't stand, that your
     life will become much simpler, then ;-) If you have problems
     running your old scripts, please let 
     <a href="mailto:H.Zeller@acm.org">me</a> know.</li>
 <li>allows a per-project storage of the commandline history, 
     variables, plugins and connections.
 <li>allows to add your own plugins that behave just like the built-in 
     commands.</li>
 <li>Is provided as OpenSource under the <a href="http://www.gnu.org/licenses/gpl.txt">GNU Public License</a>
</ul>
</body>

<h3><a name="getting-started"/>Getting started</h3>
<h4>Compilation</h4>
If you <a href="http://sourceforge.net/project/showfiles.php?group_id=47945">downloaded</a>
HenPlus as a binary RPM or debian package, you can
<a href="#running">skip</a> this part.
<p>
Ok, you are still here, so you have to compile it first. First you need
an additional library.
HenPlus utilizes the features of the GNU-readline library and therefore
uses the JNI java wrapper library &gt;=
<a href="http://sourceforge.net/project/showfiles.php?group_id=48669">java-readline 0.7.3</a>.
<p>
Building requires the <a href="http://jakarta.apache.org/ant">ant build
tool</a> (Version >= 1.4). To compile HenPlus, make sure that the 
<code>libreadline-java.jar</code> is in the classpath. By default, the 
java-readline package installs this in <code>/usr/share/java/libreadline-java.jar</code>.
<p>Now, just type
<pre>
$ ant jar
</pre>
If you are root, you can then install it:
<pre>
$ ant install
</pre>
will install henplus in
<table bgcolor="#DDDDFF" border=1>
<tr valign="top">
   <td>/usr/share/henplus/henplus.jar</td><td>The jar-file containing
                         the HenPlus classes. You can add additonal
			 jar files in this directory. All of them are
			 added to the classpath in the henplus shellscript
			 (use this for JDBC-drivers).
			 </td>
<tr><td>/usr/bin/henplus</td><td>shellscript to start henplus</td></tr>
</table>
If you want to have another installation base (default: /usr), then you 
can provide this as parameter <code>'prefix'</code>:
<pre>
$ ant -Dprefix=/usr/local install
</pre>
<font size="-1">(For package providers: the build.xml provides as well
the <code>DESTDIR</code> parameter)</font>
<p>
I haven't compiled this on Windows, but it shouldn't be a big deal .. if you manage to compile
the java-readline. If you did it, just post your experience, so that we
can include it in this documentation.

<h4><a name="running"/>Running</h4>
You can invoke HenPlus with the <code>henplus</code> shellscript
with or without an jdbc-url on the commandline.
<pre>
$ henplus jdbc:mysql://localhost/foobar
</pre>
The
important commands you need to know to get it running is <code>help</code> and
<code>connect</code>. The help command gives an overview, what commands
are supported:
<hr>
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
Hen*Plus&gt; help
 help | ?                                 : provides help for commands
 about | version | license                : about HenPlus
 exit | quit                              : exits HenPlus
 echo | prompt                            : echo argument
 list-plugins | plug-in | plug-out        : <a href="#plugins">handle Plugins</a>
 list-drivers | register | unregister     : <a href="#getting-connected">handle JDBC drivers</a>
 list-aliases | alias | unalias           : <a href="#aliases">handle Aliases</a>
 load | start | @ | @@                    : load file and execute commands
 connect | disconnect | rename-session | switch | sessions: <a href="#connect">manage sessions</a>
 status                                   : show status of this connection
 tables | views | rehash                  : list available user objects
 describe &lt;tablename&gt;                     : describe a database object
 dump-out | dump-in | verify-dump | dump-conditional: <a href="#table-dumps">handle table dumps</a>
 autocommit-on | autocommit-off           : switches autocommit on/off
 system | !                               : execute system commands
 set | unset                              : <a href="#variables">set/unset variables</a>
<a name="config-dir"/><a href="#per-project-config">config read from [/home/hzeller/.henplus]</a>
</pre></td></tr></table>
<hr>
You exit the HenPlus shell by typing the <code>exit</code> or <code>quit</code>
command or by just typing EOF-Character (CTRL-D).
<p>
Just explore the commands by typing <code>help [commandname]</code> and
learn what the built-in commands are all about. Start with the 
<code>connect</code> commmand
<pre>
Hen*Plus&gt; help connect
</pre>
(more details on connection to the database in the 
<a href="#getting-connected">Getting connected</a> section).

<h5>Semicolon is Separator</h5>
Usually, there is one line per command. However, you can have multiple
commands on one line if you separate them with a semicolon:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
echo "*** The build-in help ***" ; help
</pre></td></tr></table>
<p>
The SQL commands however (you guess it: 'select', 'update', 'create' .. ) are
not complete after the newline; you <em>always</em> have to close them
with a semicolon -- so its possible to write statements on multiple lines:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
oracle:localhost&gt; create table foobar (
                    id number(10) primary key,
                    text varchar(127)
                  );
ok. (70 msec)
oracle:localhost&gt;
</pre></td></tr></table>
<p>
Some commands are not even complete, if there is a semicolon -- these are
'create procedure' and 'create trigger' commands. These commands contain some
more complex SQL-operations that are each separated by a semicolon. This whole
command is then separated by a single slash at the beginning of a new line 
(this syntax is the same that SQLPlus supports):

<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
oracle:localhost&gt; create or replace trigger foobar_autoinc
                  before insert on foobar
                  for each row
                  begin
                    select foobar_seq.nextval into :new.id from dual;
                  end foobar_autoinc;
                  /
ok. (320 msec)
oracle:localhost&gt;
</pre></td></tr></table>

<h5>SQL-Comments</h5>
That should be enough to start working with HenPlus. But especially if you are
running scripts (with the <code>load</code>-command)
there is one additional piece of information you might
need to know: the types of comments that are ignored. AFAIK, the
SQL standard defines only an ANSI-endline comment, that starts with two dashes;
this is supported by HenPlus:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
  select * from foobar; -- this is a comment
</pre></td></tr></table>
<p>
However, other non-standard types of comments have come to use in
several SQL-shells so HenPlus ignores these as well. One style are
the C/C++/Java style comments, that comment out a range between 
<code>/*&nbsp;some&nbsp;comment&nbsp;*/</code>.
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
/*
   This is a longer comment that goes
   accross several lines
 */
 select * from foobar;
</pre></td></tr></table>
<p>
Another style of comments, allowed for instance in the 
MySQL-Shell is the UNIX-shell like '#' endline comment:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
# this is a comment.
 select * from foobar;  # a comment at the end of a line
</pre></td></tr></table>

One beta tester <!-- Andi G. --> requested an additional type of 
comment: Two semicolons at 
<em>the beginning</em> of a line comment out the whole line. The problem
with semicolon is, that it is as well used as separator between commands and
as such may of course occur twice in a row. Therefore, two 
semicolons are <em>only</em> regarded as comment, if they are the
first on a line:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
;; This line is commented out
   ;; this one as well, since there are only whitespaces on the left
select * from foobar ;; echo "this echo is executed as usual"
</pre></td></tr></table>
<p>
To make a long story short -- the supported types of comments are
<ul>
  <li>Ansi-Style <b><code>--</code></b> comment until end of line</li>
  <li>UNIX-Shell Style <b><code>#</code></b> comment until end of line</li>
  <li>Lisp-like <b><code>;;</code></b> comment until end of line</li>
  <li>C/C++/Java like <b><code>/*&nbsp;range&nbsp;comment&nbsp;*/</code></b>
</ul>
<em>Not</em> supported is the C++/Java like endline comment that starts with
two slashes <b><code>//</code></b>. The reason is, that many JDBC-URLs contain
these two slashes, and we don't want to comment these out, right ? ;-)
<p>
If you encounter some other reasonable style of comments you want that it is
supported by HenPlus, please let <a href="mailto:H.Zeller@acm.org">me</a> know.

<h3><a name="getting-connected"/>Getting connected</h3>
Getting connected to a database is simple: you need the JDBC driver
from your database vendor, put it in the classpath, register the driver
-- thats it. HenPlus provides the commands register, unregister and 
list-drivers to manage the drivers (you know it already: the <code>help</code>
command tells you more details). Some of the common drivers
are already registered by default .. however, they need to be in the CLASSPATH
still.
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
Hen*Plus&gt; list-drivers
loaded drivers are marked with '*' (otherwise not found in CLASSPATH)
------------+---------------------------------+---------------------------------------+
    <b>for</b>     |          <b>driver class</b>           |              <b>sample url</b>               |
------------+---------------------------------+---------------------------------------+
   Adabas   | de.sag.jdbc.adabasd.ADriver     | jdbc:adabasd://localhost:7200/work    |
   DB2      | COM.ibm.db2.jdbc.net.DB2Driver  | jdbc:db2://localhost:6789/foobar      |
 * MySQL    | org.gjt.mm.mysql.Driver         | jdbc:mysql://localhost/foobar         |
 * Oracle   | oracle.jdbc.driver.OracleDriver | jdbc:oracle:thin:@localhost:1521:ORCL |
 * Postgres | org.postgresql.Driver           | jdbc:postgresql://localhost/foobar    |
   SAP-DB   | com.sap.dbtech.jdbc.DriverSapDB | jdbc:sapdb://localhost/foobar         |
------------+---------------------------------+---------------------------------------+
</pre></td></tr></table>
<p>
With the <code>list-drivers</code>
command you can see what driver classes are registered and loaded. If you
cannot connect to some JDBC URL, check first, if the appropriate driver is
actually loaded. If it is not loaded, then it is probably not found in the
CLASSPATH. You can explicitly copy your frequently used drivers
into the installation directory (<code>/usr/share/henplus/</code>)</a></code>
-- all the jar/zip files
found there are added to the CLASSPATH on startup in
the <code>henplus</code> shellscript.
<p>
Drivers once registered are remembered by HenPlus, so that they are loaded
automatically on next startup. For registering and unregistering drivers,
see the online help:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
Hen*Plus&gt; help register
Hen*Plus&gt; help unregister
</pre></td></tr></table>
<p>
<a name="connect"/>
When the driver is loaded, you can connect to the database using the
JDBC-URL:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
Hen*Plus&gt; connect jdbc:oracle:thin:@localhost:1521:ORCL
HenPlus II connecting
 url 'jdbc:oracle:thin:@localhost:1521:ORCL'
 driver version 1.0
============ authorization required ===
Username: henman
Password: foobar
 Oracle - Oracle8i Enterprise Edition Release 8.1.7.0.1 - Production
JServer Release 8.1.7.0.1 - Production
 read committed *
 serializable
henman@oracle:localhost&gt;
</pre></td></tr></table>
This will then ask for the username and the password and you are
connected. <b>The password is echoed on the console as plaintext</b> -- this
is because its not possible with Java to switch the tty in non-echo mode (or
is it? Please let <a href="mailto:H.Zeller@acm.org">me</a> know);
this is a known misfeature and will be fixed sometime.
<p>
Typing JDBC-URLs is tedious ? Thats right, so HenPlus remembers all the
connection URLs you were connected to and provides it in the context
sensitive commandline completion for the connect command. So next time you
connect, you just type
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
Hen*Plus&gt; connect <b><font color="#3333FF">&lt;TAB&gt;</font></b>
jdbc:oracle:thin:@localhost:1521:ORCL  jdbc:oracle:thin:@database.my.net:1521:BLUE
Hen*Plus&gt; connect jdbc:oracle:thin:@<b><font color="#3333FF">d &lt;TAB&gt;</font></b>
Hen*Plus&gt; connect jdbc:oracle:thin:@database.my.net:1521:BLUE
</pre></td></tr></table>
.. and connecting with long URLs is a piece of cake.
<p>
On connection, the prompt changes to a string that reflects the current 
connection. By
default, this prompt is automatically extracted from the JDBC-URL, but you
can provide another name as second parameter in the connection command (see
help for the 'connect' command). Or just rename the session:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
henman@oracle:localhost&gt; rename-session hello
hello&gt;
</pre></td></tr></table>
<p>
You can disconnect with the <code>disconnect</code> command or by
simply pressing CTRL-D.

<h3><a name="multiple-open-sessions"/>Multiple Open Sessions</h3>
You can be connected to multiple databases at once; just issue the <code>connect</code>
command multiple times. You can list the sessions you are connected to
the <code>sessions</code> command.
Of course, the shell provides only access to one
session at a time so you can switch between the sessions with the 'switch' command.
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
Hen*Plus&gt; connect jdbc:oracle:thin:@localhost:1521:ORCL
<i>[... enter user/password ...]</i>
henman@oracle:localhost&gt; connect jdbc:mysql://localhost/test
mysql:localhost&gt; sessions
current session is marked with '*'
------------------------------+--------+---------------------------------------+
           <b>session</b>            |  <b>user</b>  |                 <b>url</b>                   |
------------------------------+--------+---------------------------------------+
    henman@oracle:localhost   | henman | jdbc:oracle:thin:@localhost:1521:ORCL |
  * mysql:localhost           | [NULL] | jdbc:mysql://localhost/test           |
------------------------------+--------+---------------------------------------+
mysql:localhost&gt; switch henman@oracle:localhost
henman@oracle:localhost&gt;
</pre></td></tr></table>
Of course, the switch command provides command line completion for the other
sessions names. If you only have two sessions, then its even easier: just
type <code>switch</code> without parameter (so in the example above, this would
have been sufficient).

<h3><a name="variables"/>Using Variables</h3>
You can use Variables, that can be used as text replacement everywhere. The
replacement works similar to shellscripts, however setting must be done
explicitly with the <code>set</code> command instead of a simple assignment:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
henman@oracle:localhost&gt; set tabname footab
henman@oracle:localhost&gt; select count(*) from ${tabname};
</pre></td></tr></table>
Variables can be expanded with or without curly braces: $FOO and ${FOO} is the same.
<p>
If you don't want a variable to be expanded, double the dollar-sign: <code>$$FOO</code>.
It does <em>not</em> help to embed it in single-quoted strings '$FOO'.
<p>
Unlike the shell, variables that are not set, are <em>not</em> expanded to an empty
string, but left as they are. So an unset variable $FOOBAR expands to .. $FOOBAR. This
is, because some strange scripts (esp. Oracle scripts) contain names with
dollar characters and thus would behave strange if the behaviour would be the
same as in shellscripts.
<p>
All variable settings can be shown with the <code>set</code> command without
any parameters. The settings are stored, so that they are available on next startup.

<h3><a name="commandline-completion"/>Commandline Completion</h3>
HenPlus provides a commandline completion for virtually everything: tables in
select statements, column-names in where-clauses, variable-names in set/unset command,
variable names after typing '<code>$</code>'. Just try it ..

<h3><a name="per-project-config"/>Per Project Configuration</h3>
<em>HenPlus</em> stores the commandline history, the connection-URLs and
the variable settings persistently in the filesystem. This is written
to a directory <code>~/.henplus</code>, that is createted in your
home directory.
<p>
If you have multiple projects you work on, all this information of any
of these projects is collected in the <code>~/.henplus</code> directory.
Since a per project separation of this information is desirable,
<em>HenPlus</em> supports per project storage of this information.
<p>
To store only information you use in some project, just create an empty 
<code>.henplus</code> directory in the directory you usually start the
<em>HenPlus</em> utility -- then <em>HenPlus</em> will use this directory to
store its configuration. More, if it does not find the <code>.henplus</code>
directory within the current working dir, it goes up the directory tree
until it finds the <code>.henplus</code> directory. If it still does
not find the directory, it falls back to the <code>~/.henplus</code> in your
home directory.
<p>
If you type 'help', then <em>HenPlus</em> tells you
in the <a href="#config-dir">last line</a>, where it loaded its initial 
configuration from.

<h3><a name="plugins"/>Plugins</h3>
Need some command that creates some fancy statistics or report from your
database tables ? Or need a command
that you are missing from some other database tool ? Or want to pop up
some Swing-window to do database record editing <!-- Armin H. --> ?
<p>
You are not limited with HenPlus to do this. It is very simple to write
plug-ins, that can be added and removed at run time. See <code>plug-in</code>,
<code>plug-out</code> and <code>list-plugins</code> for this. Basically, you just
need to write a class that implements the <code>henplus.Command</code> interface.
<p>
<em>(TODO: This feature needs a way to load the classes from an URLClassloader,
 so its possible to dynamically reload the classes when they changed. Anyone?)</em>

<h3><a name="aliases"/>Aliases</h3>
For certain repeating tasks its tedious to write the same command over and over again.
Therefore it is possible to store aliases.
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
henman@oracle:localhost&gt; alias ls tables
</pre></td></tr></table>
Would alias the 'tables' command so that is could be simply 'ls'.
<p>
Parameters given to aliases are appended to the original command, so that you can 
define aliases for commands that need parameters:
<table width="100%" bgcolor="#DDDDFF"><tr><td><pre>
henman@oracle:localhost&gt; alias size select count(*) from
henman@oracle:localhost&gt; size footab
execute alias: select count(*) from footab
----------+
 <b>count(*)</b> |
----------+
        9 |
----------+
1 row in result (first row: 3 msec; total: 3 msec)
</pre></td></tr></table>
Note, that even TAB-completion (in this case: of the tablename) works: the alias
command peeks into the original command that is executed when you type 'size'.
<p>
All aliases can be shown with <code>list-aliases</code>; they are stored, so that they
are available on next startup.

<h3><a name="table-dumps"/>Database independant table dumps</h3>
You can dump out tables in a database independant format. See the online help for
<code>dump-out</code> and <code>dump-in</code>. You even can dump only selected
values of a certain table; see <code>dump-conditional</code> for this.
<p>
The format that is written must be database independant, thus it is not possible to store
them as simple 'INSERT INTO..' statements, as the different databases have different
assumption how different data types should be parsed :-( Thus the dump format is a
canonical lisp like text format that is easily parsable for the human eye and external tools:
<hr noshade='noshade' size="1" />
<pre>
(tabledump 'student'
   (dump-version 1 1)
   (henplus-version 0.3.3)
   (database-info 'MySQL - 3.23.47')
   (meta ('name',   'sex',    'student_id')
         ('STRING', 'STRING', 'INTEGER'   ))
   (data ('Megan','F',1)
         ('Joseph','M',2)
         ('Kyle','M',3)
         ('Mac Donald\'s','M',4))
   (rows 4))
</pre>
<hr noshade='noshade' size="1" />
Even though XML would be an idea here, I decided against it because it blows up the file size
and is not very human readable because of the 'noise' 
(But if you want to, just write a <a href="#plugins">plug-in</a> that does this..).
[ "XML is readable but is not meant to be read" ].
<p>
One interesting feature of these commands is, that they automatically can read/write
gziped files if the filenames have the '.gz' suffix.

<h3><a name="faq"/>FAQ</h3>
This will once be the FAQ. But for now, there is only one question..

<p>
<b>Q: </b><em>When I am connected to a postgreSQL database, sometimes the
             connection seems to stop working. No select works.</em>
<br>
<b>A: </b>This is primarily not a problem with HenPlus, but in general with
         Postgres when it encounters an error in some SQL-statement. Since
	 everything in Postgres is done within a transaction, a
	 transaction is regarded invalid on some error; any subsequent 
	 commands are
	 ignored, until you finish the transaction with 'commit' or 'rollback'.
	 This might be annoying if you run SQL-scripts -- if there is only
	 one error, all subsequent commands are ignored. One solution
	 might be to switch on autocommit 
	 (HenPlus command: <code>autocommit-on</code>).
<br>
<hr noshade="noshade" size="1"/>
<div align="right"><font size="-2">$Id: HenPlus.html,v 1.7 2002-07-23 06:34:55 hzeller Exp $ &copy; Henner Zeller &lt;<a href="mailto:H.Zeller@acm.org">H.Zeller@acm.org</a>&gt;</font></div>
